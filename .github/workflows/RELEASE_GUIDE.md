# Release Action 使用指南

## 📋 功能说明

这个 GitHub Action 支持两种触发方式：

### 1. 自动触发（Tag Push）
推送以 `v` 开头的 tag 时自动触发

### 2. 手动触发（Workflow Dispatch）⭐ NEW
在 GitHub 网页上手动触发，自动更新版本号并创建 tag

---

## 🚀 手动触发使用方法

### 步骤：

1. **打开 GitHub Actions 页面**
   - 访问：`https://github.com/Wetoria/sy-plugin-enhance-codes/actions`
   - 点击左侧的 **"Create Release on Tag Push"** workflow

2. **点击 "Run workflow" 按钮**
   - 位于右上角的蓝色按钮

3. **选择版本更新类型**
   - **patch**（补丁版本）：`0.52.19` → `0.52.20`（修复 bug）
   - **minor**（次要版本）：`0.52.19` → `0.53.0`（新功能）
   - **major**（主要版本）：`0.52.19` → `1.0.0`（重大更新）
   - **manual**（手动输入）：自定义版本号

4. **（可选）输入自定义版本号**
   - 仅当选择 `manual` 时需要填写
   - 格式：`0.52.20`（不需要加 `v` 前缀）

5. **点击绿色的 "Run workflow" 确认**

---

## 🔄 执行流程

手动触发时，Action 会自动：

1. ✅ 读取当前版本号
2. ✅ 根据选择计算新版本号
3. ✅ 更新 `package.json` 和 `plugin.json`
4. ✅ 提交更改（commit message: `Release: v{版本号}`）
5. ✅ 创建并推送 tag
6. ✅ 执行构建和打包
7. ✅ 创建 GitHub Release
8. ✅ 同步发布到 `sy-plugin-enhance` 仓库
9. ✅ 发送通知到 Discord 和其他渠道

---

## 📝 示例

### 示例 1：发布补丁版本
- 当前版本：`v0.52.19`
- 选择：`patch`
- 结果：自动更新到 `v0.52.20` 并发布

### 示例 2：发布次要版本
- 当前版本：`v0.52.19`
- 选择：`minor`
- 结果：自动更新到 `v0.53.0` 并发布

### 示例 3：自定义版本号
- 当前版本：`v0.52.19`
- 选择：`manual`
- 输入：`1.0.0`
- 结果：自动更新到 `v1.0.0` 并发布

---

## ⚠️ 注意事项

1. **权限要求**：需要 `CUSTOM_TOKEN` 具有写入权限
2. **版本格式**：必须遵循语义化版本号规范（x.y.z）
3. **分支要求**：会自动推送到 `main` 分支
4. **tag 冲突**：如果 tag 已存在，操作会失败
5. **回滚**：发布后如需回滚，需要手动删除 tag 和 release

---

## 🔧 对比 release.js

| 功能 | release.js（本地） | GitHub Action（远程） |
|------|-------------------|---------------------|
| 执行环境 | 本地机器 | GitHub 服务器 |
| 版本选择 | 交互式命令行 | 网页界面选择 |
| 权限要求 | 本地 git 权限 | GitHub Token |
| 自动构建 | 需要手动运行 | 自动执行完整流程 |
| 通知发送 | 不包含 | 自动发送 Discord 通知 |
| 多仓库同步 | 不包含 | 自动同步到 sy-plugin-enhance |

---

## 🎯 推荐使用场景

- ✅ **使用 GitHub Action**：团队协作、自动化发布、完整 CI/CD
- ✅ **使用 release.js**：快速本地测试、离线环境

---

## 🐛 故障排查

### 问题 1：Workflow 找不到
**解决**：确保 `.github/workflows/release.yml` 已推送到主分支

### 问题 2：权限错误
**解决**：检查 `CUSTOM_TOKEN` 是否配置且有效

### 问题 3：版本号冲突
**解决**：检查是否已存在相同版本的 tag，删除后重试

### 问题 4：构建失败
**解决**：查看 Action 日志，检查依赖安装和构建脚本

